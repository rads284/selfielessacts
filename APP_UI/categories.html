<html>

<head>

  <title>Categories</title>

    <link href="css/categories.css" rel="stylesheet">
    <!-- Custom Fonts from Google -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

</head>

<body>
		<h1 class="title">CATEGORIES</h1>
    <a href="index.html" class="home">Home</a>

      <ul class="rolldown-list" id="myList">
        <!-- <li><span class="category">Society</span> <span class="noOfPosts">(10)</span></li>
         <li><span class="category">Personal</span> <span class="noOfPosts">(10)</span></li>
         <li><span class="category">Environment</span> <span class="noOfPosts">(10)</span></li>
        -->

      </ul>


    <div class="categoryFunctions">
        <form class ="addCat">
          <p style="text-align:center">ADD CATEGORY:</p>
          <p>Category  :  <input type="text" class="categoryName" id="addCategoryName"placeholder="Category Name"/>
          <button class="addCategory">Add</button>
        </form>
        <form class ="remCat">
          <p style="text-align:center">REMOVE CATEGORY:</p>
          <p>Category  :  <input type="text" class="categoryName" id="remCategoryName" placeholder="Category Name"/>
          <button class="remCategory">Remove</button>
        </form>
        <form class="filterPosts">
          <p style="text-align:center">FILTER POSTS BY INDEX:</p>
          <p>Start Index:  <input type="text" class="startIndex" /></p>
          <p>End Index   :  <input type="text" class="endIndex"/></p>
          <p>Category    :  <input type="text" class="categoryName" id="dispCategoryName" placeholder="Category Name"/></p>

          <button class="displayPosts">Display Posts</button>

        </form>
    </div>

    <div class="posts">
                    <!--catName will have the category heading- for display posts. And, noOfPosts - for that category
                    neeche there's one sample
                   -->



                    <!--<div class="category-title">

                  		<ul class="rolldown-list" id="myList">
                  		   <li><span class="catName">Society</span> <span class="noOfPosts">(10)</span></li>

                  		</ul>
                    </div>

                    <div class="post-container">
                          <div  class="actid">`+actid+`</div>
                          <div  class="cat">`+category+`</div>
                          <img class="usericon" src="images/usericon.png" style="padding:10px;width:7%;" alt="">
                          <div class="username">`+username+`</div>

                          <div class='removePost' onclick="">X</div>
                          <img class="post-img" src="data:image/jpeg;base64,`+imgsrc+`" alt="">
                          <img class="post-img" src="./images/concert.jpg" alt="">
                          <div class="upvote">
                                <img   src="images/upvote-psd.png" style="margin-left:10%;width:60%" alt="">
                          </div>
                          <div class="col-sm-4 noOfVotes" style="padding-top:2%;padding-left:2%;font-size:25px;color:rgb(180,180,180)">`+upvote+`votes</div>

                          <p class="lead text-muted" style="padding-left:2%">`+caption+`</p>


                    </div>-->


    </div>

</body>
</html>
<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<script>
   $(window).load(function(){
        // console.log("load");
        $.get("http://localhost:3000/api/v1/categories")
         .done(function(data){
             // console.log("GET");
             // console.log(data);

             for(var item in data){
                $("#myList").append("<li><span class='category'>"+item+"</span><span class='noOfPosts'>("+
                  data[item]+")</li>");
                //   $("select.category").append("<option value="+item+">"+item+"</option>");
                 // console.log(item,data[item]);
             }
         });
    });
   $(".addCategory").click(function(){
    var requestJson = [$("#addCategoryName").val()];
    var url = "http://54.144.195.174/api/v1/categories";
    $.ajax({
      'type':"POST",
      'url': url,
      'contentType':'application/json',
      'data' : JSON.stringify(requestJson),
      'dataType' : 'json',
    }).done(function(data){
      location.reload();
    });
    return false;
   });
   $(".remCategory").click(function(){
    var url = "http://54.144.195.174/api/v1/categories/" + $("#remCategoryName").val();
    $.ajax({
      'type':"DELETE",
      'url': url,
    }).done(function(data){
      location.reload();
    });
    return false;
   });
   $(".displayPosts").click(function(){
    console.log($("#dispCategoryName").val());
    var url = "http://localhost:3000/api/v1/categories/" + $("#dispCategoryName").val() + "/acts";
    // console.log(url);
    if(($(".startIndex").val().length) !== 0 || ($(".endIndex").val().length) !== 0){
      url += "?start=" + $(".startIndex").val() + "&end=" + $(".endIndex").val()
    }
    console.log(url);
    // location.reload();
    $.get(url)
    .done(function(data){

      console.log(data);
     for(var item in data){
      console.log(item);
         username = data[item].username;
         category = data[item].category;
         upvote = parseInt(data[item].upVotes);
         imgsrc = data[item].imgB64;
         caption = data[item].caption;
         actid = data[item].actId;
         var actBlock = `<!--<div class="post-container">
                                 <div  class="actid">`+actid+`</div>
                                 <div  class="cat">`+category+`</div>
                                 <img class="usericon" src="images/usericon.png" style="padding:10px;width:7%;" alt="">
                                 <div class="username">`+username+`</div>

                                 <div class='removePost' onclick="">X</div>
                                 <img class="post-img" src="data:image/jpeg;base64,`+imgsrc+`" alt="">

                                 <div class="upvote">
                                       <img   src="images/upvote-psd.png" style="margin-left:10%;width:60%" alt="">
                                 </div>
                                 <div class="col-sm-4 noOfVotes" style="padding-top:2%;padding-left:2%;font-size:25px;color:rgb(180,180,180)">`+upvote+`votes</div>

                                 <p class="lead text-muted" style="padding-left:2%">`+caption+`</p>
                         </div>-->`;
         $(".posts").append(actBlock);
         $(".content").last().find(".upvote").click(function(){
             up(this);
         });
         $(".content").last().find(".removePost").click(function(){
             up1(this);
             $(this).parent().parent().parent().remove();
         });
     }
   });
    return false;
  });
</script>
